<!DOCTYPE html>

<html>
<head>
<title>ADMIN Page</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="apple-touch-icon" sizes="76x76"
	href="./assets/img/apple-icon.png">
<link rel="icon" type="image/png" href="./assets/img/favicon.png">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

<meta content='width=device-width, initial-scale=1.0, shrink-to-fit=no'
	name='viewport' />
<!--     Fonts and icons     -->
<link rel="stylesheet" type="text/css"
	href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:400,700|Material+Icons" />
<link rel="stylesheet"
	href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css">
<!-- CSS Files -->
<link href="css/material-kit.css?v=2.0.7" rel="stylesheet" />
<link href="demo/demo.css" rel="stylesheet" />
<link class="skin" rel="stylesheet" type="text/css"
	href="css/sweet-alert.min.css" />
</head>
<body class="index-page sidebar-collapse">
<nav class="navbar navbar-expand-lg bg-rose">
                <div class="container">
                  <div class="navbar-translate">
                    <a class="navbar-brand" href="#0">Automated Student Result Processing System</a>
                    <button class="navbar-toggler" type="button" data-toggle="collapse" aria-expanded="false" aria-label="Toggle navigation">
                      <span class="sr-only">Toggle navigation</span>
                      <span class="navbar-toggler-icon"></span>
                      <span class="navbar-toggler-icon"></span>
                      <span class="navbar-toggler-icon"></span>
                    </button>
                  </div>
                  <div class="collapse navbar-collapse">
                    <ul class="navbar-nav">
                      <li class="nav-item active">
                        <a href="javascript:;" class="nav-link">Aiti-Kace</a>
                      </li>
                      <li class="nav-item">
                        <a href="javascript:;" class="nav-link">Ghana-India Kofi Annan Centre for Excellence in ICT</a>
                      </li>
                    </ul>
                      <form class="form-inline ml-auto" action="/search">
                      <div class="form-group has-white">
                        <input type="text" class="form-control" placeholder="Search" name="q">
                      </div>
                      <button type="submit" class="btn btn-white btn-raised btn-fab btn-round">
                        <i class="material-icons">search</i>
                      </button>
                    </form>
                  </div>
                </div>
              </nav>
              <!--  navbar -->
              <!--  navbar -->
             <div class="main-panel">
                <div class="content">
                    <div class="container-fluid">
                        <div class="row">
                            <div class="col-md-12">
                                <div class="card">

                                   
                                    <div class="card-body">
                                      <div class="toolbar">
                                       

                                            <div class="row">
                                                <div class="col-sm-8">
                                                     
                                                    
                                                </div>
                                                <div class="col-md-4">
                                                      <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModal">
                                                        Add Student
                                                      </button>
                                                      
                                                    <a href="/student" class="btn btn-info btn-round ">Refresh</a>
                                                    
                                                    <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                                        <div class="modal-dialog" role="document">
                                                          <div class="modal-content">
                                                            <div class="modal-header">
                                                              <h5 class="modal-title" id="exampleModalLabel">Enter Student Details</h5>
                                                              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                                <span aria-hidden="true">&times;</span>
                                                              </button>
                                                            </div>
                                                              <form id="studentprofileform">
                                                                <div class="modal-body">

                                                                        <div class="form-group">
                                                                          <label for="Name">Student Name</label>
                                                                          <input type="text" required class="form-control" id="name" name="name" aria-describedby="nameHelp" >
                                                                          <small id="nameHelp" class="form-text text-muted">Enter your user name</small>
                                                                        </div>
                                                                        
                                                                        <div class="form-group">
                                                                          <label for="email">Student Email</label>
                                                                          <input type="email" required class="form-control" id="email" name="email" aria-describedby="emailHelp" >
                                                                          <small id="emailHelp" class="form-text text-muted">Enter user email</small>
                                                                        </div>
                                                                        
                                                                        <div class="form-group">
                                                                          <label for="gender">Student Gender</label>
                                                                          <input type="text" required class="form-control" id="gender" name="gender" aria-describedby="genderHelp" >
                                                                          <small id="genderHelp" class="form-text text-muted">Enter user gender</small>
                                                                        </div>
                                                                        
                                                                        <div class="form-group">
                                                                          <label for="registrationdate">Student Registration Date</label>
                                                                          <input type="text" required class="form-control" id="registrationdate" name="regiestrationdate" aria-describedby="registrationdateHelp" >
                                                                          <small id="registrationdateHelp" class="form-text text-muted">Enter user registration date</small>
                                                                        </div>
                                                                        
                                                                        <div class="form-group">
                                                                          <label for="role">User Role</label>
                                                                          <select class="selectpicker form-control"  
                                                                                data-style="select-with-transition" title="Choose Role" 
                                                                                data-size="5" required="true" 
                                                                                name="role"  id="role">
                                                                
                                                                              <option value="" >----Please select User----</option>
                                                                              <option value="ROLE_STUDENT" >ADMIN</option>
                                                                              <option value="ROLE_LECTURER" >LECTURER</option>
                                                             
                                                                          </select>
                                                                          
                                                                        </div>
                                                                    
                                                                        
                                                                    <input type="hidden"  id="studentId" value="0"/>

                                                                </div>
                                                                <div class="modal-footer">
                                                                  <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                                                  <button type="submit" id="btnAddStudent" class="btn btn-primary">Save changes</button>
                                                                </div>
                                                               </form>
                                                          </div>
                                                        </div>
                                                      </div>
                                                    
                                                    <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                                        <div class="modal-dialog" role="document">
                                                          <div class="modal-content">
                                                            <div class="modal-header">
                                                              <h5 class="modal-title" id="exampleModalLabel">Add student</h5>
                                                              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                                <span aria-hidden="true">&times;</span>
                                                              </button>
                                                            </div>
                                                             
                                                          </div>
                                                        </div>
                                                      </div>
                                                    <!-- Notice if there would be changes -->
                                                    
                                                </div>
                                            </div>

                                        </div>
                                        <br/>

                                            
                                            <div class="material-datatables">
                                                
                                                <table id="datatables" class="table table-striped table-no-bordered table-hover" cellspacing="0" width="100%" style="width:100%">
                                                <thead>
                                                  <tr>

                                                   
                                                    <th>Id</th>
                                                    <th>User Name</th>
                                                    <th>User AccessLevel</th>
                                                    <th class="text-left">Actions</th>
                                                  </tr>
                                                </thead>
                                                <tfoot>
                                                  <tr>

                                                    <th>Id</th>
                                                    <th>User Name</th>
                                                    <th>User AccessLevel</th>


                                                    <th class="text-left">Actions</th>
                                                  </tr>
                                                </tfoot>
                                                <tbody>

                                                    <tr th:each="pro: ${user}">

                                                        <td  th:text="${pro.id}"></td>
                                                        <td th:text="${pro.username}">Student Name</td>
                                                             
                                                        <td th:text="${pro.email}">User Email</td>
                                                        

                                                        <td class="td-actions text-left" >
                                                            <button  th:data-url="@{/userDetails/{id}(id=${pro.id})}" class="btn btn-info btn-round btn-sm reset-action" 
                                                                 title="Edit user">
                                                                <i class="material-icons">update</i>

                                                            </button>

                                                            <button  th:data-url="@{/deleteuser/{id}(id=${pro.id})}"
                                                                data-request-type="delete" class="btn btn-rose btn-round btn-sm remove">
                                                                   <i class="material-icons">delete</i>
                                                            </button>
                                                         </td>
                                                    </tr>
                             

                                                </tbody>
                                              </table>
                                              <!---MODALS -->
                                              <div class="modal fade" id="updateuserModal" tabindex="-1" role="dialog" aria-labelledby="deleteLabel" aria-hidden="true">
                                                    <div class="modal-dialog">
                                                        <div class="modal-content">
                                                            <div class="modal-header">
                                                              <h4 class="modal-title" id="deleteLabel">Password Reset</h4>
                                                            </div>
                                                            <form  method="post"   class="form-horizontal" role="form" id="fileUploadForm" >

                                                            <div class="modal-body">
                                                                <p id="userpassMsg">You have selected to reset this user's password.</p>
                                                                 

                                                            </div>
                                                            <div class="modal-footer">
                                                                 <button type="button" id="rset" class="btn btn-success" data-dismiss="modal">Cancel</button>
                                                                 <button type="submit" class="btn btn-danger" id="btnSubmit">Change Password</button>
                                                            </div>
                                                      </form>

                                                   </div>
                                                  </div>
                                                </div>
                                
                      

                                            </div>
                                    </div>

                
                                </div>
                                <!-- end content-->
                                </div>
                                <!--  end card  -->
                                <div class="modal fade" id="signupModal2" tabindex="-1" role="dialog" aria-labelledby="deleteLabel" aria-hidden="true">
                    <div class="modal-dialog">
                       <div class="modal-content">
                          <div class="modal-header">
                            <h4 class="modal-title" id="deleteLabel">Assign Incoming</h4>
                          </div>
                           <div class="modal-body">
                               <p id="txtAssign"></p>
                               
                                
                               <p id="txtAssignDetails">
                                   If this was the action that you wanted to do,
                                     please confirm your choice, or cancel and return to the page.
                               </p>
                          </div>
                           <div class="modal-footer">
                                <button type="button" class="btn btn-success" data-dismiss="modal">Cancel</button>
                                <button type="button" class="btn btn-danger" id="confirmAssign">Assign Incoming</button>
                           </div>
                         </div>
                      </div>
                  </div>
                   
          </div>
          <!-- end col-md-12 -->
          </div>
          <!-- end row -->
          </div>
          </div>
          <div th:insert="footer :: footer"></div>
        
        
    <script src="js/core/jquery.min.js" type="text/javascript"></script>
    <script src="js/core/popper.min.js" type="text/javascript"></script>
    <script src="js/core/bootstrap-material-design.min.js" type="text/javascript"></script>
    <script src="js/plugins/moment.min.js"></script>
    <script src="js/plugins/bootstrap-datetimepicker.js" type="text/javascript"></script>
    <script src="js/material-kit.js?v=2.0.7" type="text/javascript"></script>
  
    <script src="js/jquery.dataTables.min.js"></script>
    <script src="js/sweetalert2.js"></script>
    
  <script>
    $(document).ready(function() {
        
        $("#btnAddStudent").on("click",function(e){
        e.preventDefault();
        var access = "";
        var useremail = $("#email").val();
        var userpassword = $("#password").val();
        var name = $("#username").val();
        var role = $("#accesslevel").val();
       
           var url =`/createUser?accessLevel=${access}&email=${useremail}&password=${userpassword}&username=${name}&rolename=${role}`;
           $.ajax({    // ajax request
                type: "POST",
                url: url,
                processData: false,
                cache: false, 
                timeout: 600000, // after 
                success: function (result) {  // if everything goes through return success
                    switch(result){
                        case "SUCCESS":
                            swal({title: "Success!", text: "User added successfully!",type: "success",icon: "success",button: "Ok!"})
                            .then((value) => {
                                location.reload();
                                    
                             });
                            
                            break;
                        default:
                           swal("Unsuccessful", "Sorry, We couldn't add your user :)", "error");  
                            modal.modal('hide');
                            $("#btnAddUser").prop("disabled", false);
                            break;
                    }
                      
                },
                error: function (e) {
                    swal("Unsuccessful", "Sorry, We couldn't add your user :)", "error");  
                     $("#btnAddUser").prop("disabled", false);
                }
            });
       });
        
        $("#frm").on("submit" ,function(e){
            e.preventDefault();
            $("#btnAddUser").prop("disabled", true);
            $("#exampleModal").modal();
            var user  = {
                Name: $("#studentName").val(),
                course: $("#course").val(),
                Date: $("#registrationDate").val(), 
                Level: $("#courseLevel").val(),
                pyt: $("#python").val(),
                script: $("#javascript").val(),
                Database: $("#oracleDatabase").val(),
                software: $("#softwareEngineering").val(),
                id : $('#userId').val(),
                Id: $('#StudentId').val()
            };
            
            alert(user.studentId);
               
            var url = "/user?name="+user.studentName+"&course="+user.course+"&Date="+user.registrationDate+"&Level="+user.courseLevel
            		+"&pyt="+user.python+"&script="+user.javascript+"&Datebase="+user.oracleDatebase
            		+"&Engineering="+user.softwareEngineering+"&id="+user.userid+"&Id="+user.studentId;
           
            $.ajax({
                type: "POST",
                url: url,
                data:product,
                processData: false,
                cache: false,
                timeout: 600000,
                success: function (result) {
                    switch(result){
                        case "SUCCESS":
                            swal({title: "Success!", text: "User added successfully!",type: "success",icon: "success",button: "Ok!"})
                            .then((value) => {
                                location.reload();
                                    
                             });
                            
                            break;
                        default:
                           swal("Unsuccessful", "Sorry, We couldn't add your user :)", "error");  
                            modal.modal('hide');
                            $("#btnAddUser").prop("disabled", false);
                            break;
                    }
                      
                },
                error: function (e) {
                    swal("Unsuccessful", "Sorry, We couldn't add your User :)", "error");  
                     $("#btnAddUser").prop("disabled", false);
                }
            });
             
          
        });
        
        
        var table;                 
            $(document).ready(function() {
               table =  $('#datatables').DataTable({
                "pagingType": "full_numbers",
                "lengthMenu": [
                  [10, 25, 50, -1],
                  [10, 25, 50, "All"]
                ],
                responsive: true,
                language: {
                  search: "_INPUT_",
                  searchPlaceholder: "Search records",
                }
              });
            });
            $('#datatables tbody').on( 'click', '.remove', function () {
                var url = $(this).attr("data-url");
                swal({
                    title: "Are you sure?",
                    text: "You will not be able to recover this product !",
                    icon: 'warning',
                    showCancelButton: true,   
                    confirmButtonColor: "#DD6B55",   
                    confirmButtonText: "Yes, delete it!",   
                    cancelButtonText: "No, cancel plx!",
                    dangerMode: true,
                    buttons: {
                      cancel: 'Yes, delete it!',
                      delete: 'No, cancel plx!'
                    }
                  }).then(function (willDelete) {
                    if (willDelete) {
                        $.get(url,function(del){
                            if(del){
                                swal("Deleted!", "Your user has been deleted.", "success");  
                                table.row('.selected').remove().draw( false );
                                
                            }else{
                                swal("Error", "Sorry we couldnt delete your user :)", "error"); 
                            }
                        });
                    } else {
                       swal("Error", "Sorry we couldnt delete your user :)", "error"); 
                    }
                  });
                });
                
                //End of Script
                
                $('#datatables tbody').on( 'click', '.reset-action', function () {
                    var url = $(this).attr("data-url");
             
                    var modal = $('#exampleModal').modal();
                    $('#exampleModalLabel').html("Edit user");
                    
                    $.get(url,function(data){
                        $('#name').val(data.name);
                        $('#role').val(data.role);
                        $('email').val(data.email);
                        $('#studentId').val(data.id);
                    });
                   
                    
                    
                     modal.show();
                
                });
 
     
    });
    
 
        function scrollToDownload() {
          if ($('.section-download').length != 0) {
            $("html, body").animate({
              scrollTop: $('.section-download').offset().top
            }, 1000);
          }
        }
        
    
  </script>
              
</body>

</html>
